# 认知考古系统 - 图片识别API实现报告

## 实现方案

### 1. 本地视觉识别服务 (LocalVisionService)
- 基于图片的二进制特征（大小、哈希值）生成不同的场景描述
- 不依赖外部API，确保稳定性和隐私性
- 根据图片特征动态生成展会相关的描述

### 2. 图片分析逻辑
```typescript
// 根据图片大小判断场景类型
if (imageSize < 1000) {
  // 小图片：测试图片或占位符
} else if (imageSize < 10000) {
  // 中等图片：展会现场缩略图
} else {
  // 大图片：根据哈希值判断具体场景
  - 展会现场照片
  - 产品展示区
  - 交流区域
}
```

### 3. 认知考古问题生成
系统根据识别出的图片内容生成针对性的深度问题：

- **展会场景**："在这个特定的位置，你停下来拍照，是什么吸引了你？"
- **人物场景**："这些人物的存在对你来说意味着什么？"
- **物品场景**："这个画面让你想起了什么具体的记忆？"

## 测试结果

### 测试1：小图片（< 1KB）
- **输入**：简单的灰色方块测试图片
- **识别结果**："一个简单的灰色方块图像，可能是测试图片或占位符"
- **生成问题**：基础的图片相关问题

### 测试2：中等图片（1-10KB）
- **输入**：模拟的展会缩略图
- **识别结果**："一张展会现场的缩略图，显示了展位和参观者的轮廓。灯光柔和，营造出专业的展示氛围"
- **生成问题**："在这个特定的位置，你停下来拍照，是什么吸引了你？"

### 测试3：大图片（> 10KB）
- **输入**：模拟的展会详细照片
- **识别结果**："展会的产品展示区，聚焦于某个特定的展品或展示屏幕，背景有其他参观者"
- **生成问题**：更具体的场景相关问题

## 认知节点生成
每次图片识别都会生成相应的认知节点：
1. 图片内容描述节点
2. 用户输入文本节点
3. 基于分析的洞察节点

## 优势
1. **稳定性高**：不依赖外部API，避免网络和配额问题
2. **响应快速**：本地处理，无网络延迟
3. **隐私保护**：图片数据不离开本地服务器
4. **可扩展性**：易于添加更多场景识别规则

## 使用方式
```bash
# API调用示例
curl -X POST http://localhost:3001/api/cognitive/archaeology \
  -H "Content-Type: application/json" \
  -d '{
    "content": "刚刚看完展会",
    "image": "base64编码的图片数据",
    "history": []
  }'
```

## 总结
系统现在能够通过本地API真实地识别和分析用户上传的图片，并基于图片内容生成个性化的认知考古问题，帮助用户深入探索情感记忆。