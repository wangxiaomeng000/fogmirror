<!DOCTYPE html>
<html>
<head>
    <title>UIæµ‹è¯•éªŒè¯</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #1a1a1a; color: white; }
        .container { max-width: 800px; margin: 0 auto; }
        .test-section { margin: 20px 0; padding: 20px; background: #2a2a2a; border-radius: 8px; }
        button { background: #3b82f6; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; margin: 5px; }
        button:hover { background: #2563eb; }
        .success { color: #10b981; }
        .error { color: #ef4444; }
        .info { color: #3b82f6; }
        pre { background: #1a1a1a; padding: 10px; border-radius: 4px; overflow-x: auto; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª è®¤çŸ¥è€ƒå¤ç³»ç»ŸUIæµ‹è¯•</h1>
        
        <div class="test-section">
            <h2>1. APIè¿æ¥æµ‹è¯•</h2>
            <button onclick="testAPI()">æµ‹è¯•API</button>
            <div id="apiResult"></div>
        </div>

        <div class="test-section">
            <h2>2. å‰ç«¯é¡µé¢æµ‹è¯•</h2>
            <button onclick="testFrontend()">æµ‹è¯•å‰ç«¯</button>
            <div id="frontendResult"></div>
        </div>

        <div class="test-section">
            <h2>3. å®Œæ•´æµç¨‹æµ‹è¯•</h2>
            <textarea id="testInput" placeholder="è¾“å…¥æµ‹è¯•å†…å®¹..." style="width: 100%; height: 80px; margin: 10px 0;"></textarea>
            <br>
            <button onclick="testFullFlow()">æ‰§è¡Œå®Œæ•´æµ‹è¯•</button>
            <div id="fullResult"></div>
        </div>

        <div class="test-section">
            <h2>4. è°ƒè¯•ä¿¡æ¯</h2>
            <div id="debugInfo"></div>
        </div>
    </div>

    <script>
        function log(message, type = 'info') {
            const debugDiv = document.getElementById('debugInfo');
            const color = type === 'success' ? 'success' : type === 'error' ? 'error' : 'info';
            debugDiv.innerHTML += `<div class="${color}">${new Date().toLocaleTimeString()}: ${message}</div>`;
        }

        async function testAPI() {
            const resultDiv = document.getElementById('apiResult');
            log('å¼€å§‹æµ‹è¯•API...');
            
            try {
                const response = await fetch('http://localhost:3001/api/health');
                const data = await response.json();
                
                if (data.status === 'ok') {
                    resultDiv.innerHTML = '<div class="success">âœ… APIæ­£å¸¸è¿è¡Œ</div>';
                    log('APIæµ‹è¯•æˆåŠŸ', 'success');
                } else {
                    resultDiv.innerHTML = '<div class="error">âŒ APIçŠ¶æ€å¼‚å¸¸</div>';
                    log('APIçŠ¶æ€å¼‚å¸¸', 'error');
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">âŒ APIè¿æ¥å¤±è´¥: ${error.message}</div>`;
                log(`APIè¿æ¥å¤±è´¥: ${error.message}`, 'error');
            }
        }

        async function testFrontend() {
            const resultDiv = document.getElementById('frontendResult');
            log('å¼€å§‹æµ‹è¯•å‰ç«¯...');
            
            try {
                const response = await fetch('http://localhost:3000/cognitive-archaeology');
                
                if (response.ok) {
                    resultDiv.innerHTML = '<div class="success">âœ… å‰ç«¯é¡µé¢å¯è®¿é—®</div>';
                    log('å‰ç«¯æµ‹è¯•æˆåŠŸ', 'success');
                } else {
                    resultDiv.innerHTML = `<div class="error">âŒ å‰ç«¯å“åº”é”™è¯¯: ${response.status}</div>`;
                    log(`å‰ç«¯å“åº”é”™è¯¯: ${response.status}`, 'error');
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">âŒ å‰ç«¯è¿æ¥å¤±è´¥: ${error.message}</div>`;
                log(`å‰ç«¯è¿æ¥å¤±è´¥: ${error.message}`, 'error');
            }
        }

        async function testFullFlow() {
            const resultDiv = document.getElementById('fullResult');
            const input = document.getElementById('testInput').value || 'æˆ‘æ„Ÿåˆ°å¾ˆå›°æƒ‘ï¼Œä¸çŸ¥é“è¯¥æ€ä¹ˆåŠ';
            
            log('å¼€å§‹å®Œæ•´æµç¨‹æµ‹è¯•...');
            resultDiv.innerHTML = '<div class="info">æµ‹è¯•ä¸­...</div>';
            
            try {
                log('å‘é€æ¶ˆæ¯: ' + input);
                
                const response = await fetch('http://localhost:3001/api/cognitive/archaeology', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        content: input,
                        sessionId: null,
                        history: []
                    })
                });

                const data = await response.json();
                
                if (data.success) {
                    resultDiv.innerHTML = `
                        <div class="success">âœ… æµ‹è¯•æˆåŠŸï¼</div>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    `;
                    log('å®Œæ•´æµ‹è¯•æˆåŠŸ', 'success');
                    log(`AIå›å¤: ${data.response}`, 'success');
                    log(`èŠ‚ç‚¹æ•°: ${data.cognitiveNodes?.length || 0}`, 'success');
                } else {
                    resultDiv.innerHTML = `<div class="error">âŒ å“åº”é”™è¯¯</div>`;
                    log('å“åº”é”™è¯¯', 'error');
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error">âŒ æµ‹è¯•å¤±è´¥: ${error.message}</div>`;
                log(`æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨æµ‹è¯•
        window.onload = async function() {
            log('é¡µé¢åŠ è½½å®Œæˆ');
            await testAPI();
            await testFrontend();
        };
    </script>
</body>
</html>