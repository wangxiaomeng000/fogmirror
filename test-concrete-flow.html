<!DOCTYPE html>
<html>
<head>
    <title>å…·ä½“åŒ–AIå¯¹è¯æµ‹è¯• - å›¾ç‰‡åˆ†æç‰ˆ</title>
    <meta charset="utf-8">
    <style>
        body { font-family: Arial; padding: 20px; max-width: 1000px; margin: 0 auto; background: #f0f0f0; }
        .container { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 3px 15px rgba(0,0,0,0.1); }
        h1 { color: #333; text-align: center; margin-bottom: 10px; }
        .subtitle { text-align: center; color: #666; margin-bottom: 30px; }
        
        .chat-container { display: flex; gap: 20px; height: 500px; }
        .chat-box { flex: 1; border: 1px solid #e0e0e0; padding: 20px; overflow-y: auto; background: #fafafa; border-radius: 10px; }
        .analysis-panel { width: 300px; border: 1px solid #e0e0e0; padding: 20px; overflow-y: auto; background: #f5f5ff; border-radius: 10px; }
        
        .message { margin: 15px 0; padding: 12px 16px; border-radius: 10px; max-width: 80%; }
        .user-msg { background: #e3f2fd; margin-left: auto; text-align: right; }
        .ai-msg { background: #f3e5f5; }
        
        .input-area { margin-top: 20px; }
        .input-row { display: flex; gap: 10px; margin-bottom: 10px; }
        textarea { flex: 1; padding: 12px; border: 1px solid #ddd; border-radius: 8px; resize: vertical; min-height: 60px; }
        button { padding: 12px 24px; background: #5e35b1; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; }
        button:hover { background: #4527a0; }
        
        .image-upload { margin-bottom: 10px; }
        .image-upload input[type="file"] { 
            padding: 10px; 
            border: 2px dashed #ddd; 
            border-radius: 8px; 
            width: 100%; 
            cursor: pointer;
        }
        
        .uploaded-image { max-width: 200px; max-height: 150px; margin: 10px 0; border-radius: 8px; }
        
        .analysis-section { margin-bottom: 20px; }
        .analysis-section h3 { color: #5e35b1; margin-bottom: 10px; }
        .analysis-item { background: white; padding: 8px 12px; margin: 5px 0; border-radius: 5px; font-size: 14px; }
        
        .status { text-align: center; color: #666; margin: 10px 0; padding: 10px; background: #fff3cd; border-radius: 8px; }
        .connected { background: #d4edda; color: #155724; }
        
        .demo-buttons { text-align: center; margin-top: 20px; }
        .demo-button { background: #ff5722; margin: 0 5px; }
        .demo-button:hover { background: #e64a19; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¯ å…·ä½“åŒ–AIæƒ…æ„Ÿæ”¯æŒç³»ç»Ÿ</h1>
        <p class="subtitle">AIä¼šåˆ†æå›¾ç‰‡å†…å®¹ï¼Œå¹¶åŸºäºå…·ä½“ç»†èŠ‚ä¸æ‚¨å¯¹è¯</p>
        
        <div class="status" id="status">è¿æ¥çŠ¶æ€ï¼šæ£€æŸ¥ä¸­...</div>
        
        <div class="chat-container">
            <div class="chat-box" id="chatBox">
                <div class="ai-msg message">ä½ å¥½ï¼æˆ‘åœ¨è¿™é‡Œå€¾å¬ã€‚å¦‚æœä½ æ„¿æ„ï¼Œå¯ä»¥åˆ†äº«ç…§ç‰‡å’Œæƒ³æ³•ï¼Œæˆ‘ä¼šä»”ç»†è§‚å¯Ÿå¹¶ä¸ä½ æ·±å…¥äº¤æµã€‚</div>
            </div>
            
            <div class="analysis-panel">
                <h3>ğŸ” AIè§‚å¯Ÿåˆ†æ</h3>
                <div id="imageAnalysis" class="analysis-section">
                    <div class="analysis-item">ç­‰å¾…å›¾ç‰‡ä¸Šä¼ ...</div>
                </div>
                
                <h3>ğŸ’­ æƒ…æ„Ÿæ´å¯Ÿ</h3>
                <div id="emotionalAnalysis" class="analysis-section">
                    <div class="analysis-item">ç­‰å¾…å¯¹è¯å¼€å§‹...</div>
                </div>
            </div>
        </div>
        
        <div class="input-area">
            <div class="image-upload">
                <input type="file" id="imageInput" accept="image/*" onchange="previewImage(event)">
                <div id="imagePreview"></div>
            </div>
            <div class="input-row">
                <textarea id="messageInput" placeholder="åˆ†äº«ä½ çš„æƒ³æ³•å’Œæ„Ÿå—..." onkeypress="if(event.key==='Enter' && !event.shiftKey) { event.preventDefault(); sendMessage(); }"></textarea>
                <button onclick="sendMessage()">å‘é€</button>
            </div>
        </div>
        
        <div class="demo-buttons">
            <button class="demo-button" onclick="runDemo1()">æ¼”ç¤º: å±•è§ˆç…§ç‰‡</button>
            <button class="demo-button" onclick="runDemo2()">æ¼”ç¤º: è€ç…§ç‰‡å›å¿†</button>
            <button class="demo-button" onclick="runDemo3()">æ¼”ç¤º: æ—¥å¸¸åˆ†äº«</button>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:3001/api';
        let sessionId = 'concrete-test-' + Date.now();
        let selectedImage = null;
        
        async function checkStatus() {
            try {
                const response = await fetch(`${API_URL}/health`);
                const data = await response.json();
                document.getElementById('status').textContent = 
                    `âœ… å·²è¿æ¥ | ${data.mode} | AIæœåŠ¡ï¼š${data.ai}`;
                document.getElementById('status').className = 'status connected';
            } catch (error) {
                document.getElementById('status').textContent = 'âŒ è¿æ¥å¤±è´¥';
            }
        }
        
        function previewImage(event) {
            const file = event.target.files[0];
            if (file) {
                selectedImage = file;
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('imagePreview').innerHTML = 
                        `<img src="${e.target.result}" class="uploaded-image">`;
                };
                reader.readAsDataURL(file);
            }
        }
        
        async function sendMessage() {
            const input = document.getElementById('messageInput');
            const content = input.value.trim();
            if (!content && !selectedImage) return;
            
            // æ˜¾ç¤ºç”¨æˆ·æ¶ˆæ¯
            const userMsgDiv = document.createElement('div');
            userMsgDiv.className = 'message user-msg';
            userMsgDiv.textContent = content || 'ï¼ˆå‘é€äº†ä¸€å¼ å›¾ç‰‡ï¼‰';
            
            if (selectedImage) {
                const imgElement = document.createElement('img');
                imgElement.src = URL.createObjectURL(selectedImage);
                imgElement.className = 'uploaded-image';
                userMsgDiv.appendChild(document.createElement('br'));
                userMsgDiv.appendChild(imgElement);
            }
            
            document.getElementById('chatBox').appendChild(userMsgDiv);
            input.value = '';
            
            try {
                const formData = new FormData();
                formData.append('content', content);
                formData.append('sessionId', sessionId);
                if (selectedImage) {
                    formData.append('image', selectedImage);
                }
                
                const response = await fetch(`${API_URL}/chat/message`, {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // æ˜¾ç¤ºAIå›å¤
                    addMessage(data.aiMessage.content, 'ai');
                    
                    // æ›´æ–°å›¾ç‰‡åˆ†æ
                    if (data.aiMessage.imageAnalysis) {
                        updateImageAnalysis(data.aiMessage.imageAnalysis);
                    }
                    
                    // æ›´æ–°æƒ…æ„Ÿåˆ†æ
                    if (data.aiMessage.analysis) {
                        updateEmotionalAnalysis(data.aiMessage.analysis);
                    }
                    
                    // æ¸…é™¤å·²é€‰å›¾ç‰‡
                    selectedImage = null;
                    document.getElementById('imageInput').value = '';
                    document.getElementById('imagePreview').innerHTML = '';
                } else {
                    addMessage('æŠ±æ­‰ï¼Œå‘é€å¤±è´¥ï¼š' + data.error, 'ai');
                }
            } catch (error) {
                addMessage('æŠ±æ­‰ï¼Œç½‘ç»œé”™è¯¯ï¼š' + error.message, 'ai');
            }
            
            document.getElementById('chatBox').scrollTop = document.getElementById('chatBox').scrollHeight;
        }
        
        function addMessage(content, type) {
            const chatBox = document.getElementById('chatBox');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}-msg`;
            messageDiv.textContent = content;
            chatBox.appendChild(messageDiv);
            chatBox.scrollTop = chatBox.scrollHeight;
        }
        
        function updateImageAnalysis(analysis) {
            const panel = document.getElementById('imageAnalysis');
            panel.innerHTML = `
                <div class="analysis-item"><strong>æ¦‚è§ˆï¼š</strong>${analysis.overview}</div>
                ${analysis.details.map(d => `<div class="analysis-item">â€¢ ${d}</div>`).join('')}
                <div class="analysis-item"><strong>æ°›å›´ï¼š</strong>${analysis.atmosphere}</div>
            `;
        }
        
        function updateEmotionalAnalysis(analysis) {
            const panel = document.getElementById('emotionalAnalysis');
            panel.innerHTML = `
                <div class="analysis-item"><strong>æƒ…æ„ŸåŸºè°ƒï¼š</strong>${analysis.emotionalTone.primary} (${(analysis.emotionalTone.intensity * 100).toFixed(0)}%)</div>
                ${analysis.insights.map(i => `<div class="analysis-item">â€¢ ${i}</div>`).join('')}
                <div class="analysis-item"><strong>å»ºè®®ï¼š</strong>${analysis.suggestions[0]}</div>
            `;
        }
        
        // æ¼”ç¤ºåŠŸèƒ½
        function runDemo1() {
            document.getElementById('messageInput').value = 'æˆ‘åœ¨ç¯å¢ƒä¿æŠ¤å±•è§ˆä¸Šçœ‹åˆ°è¿™äº›ç…§ç‰‡ï¼Œç‰¹åˆ«æ˜¯å…³äºæ²³æµæ±¡æŸ“çš„éƒ¨åˆ†ï¼Œè®©æˆ‘æƒ³èµ·äº†å®¶ä¹¡çš„å˜åŒ–';
            // æ¨¡æ‹Ÿå›¾ç‰‡é€‰æ‹©
            document.getElementById('imagePreview').innerHTML = '<img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjE1MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMjAwIiBoZWlnaHQ9IjE1MCIgZmlsbD0iIzMzMyIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPuWxleiniOeFp+eJhzwvdGV4dD48L3N2Zz4=" class="uploaded-image">';
            addMessage('ï¼ˆæ¼”ç¤ºæ¨¡å¼ï¼šå‡è®¾å·²é€‰æ‹©å±•è§ˆç…§ç‰‡ï¼‰', 'ai');
        }
        
        function runDemo2() {
            document.getElementById('messageInput').value = 'ç¿»åˆ°è¿™å¼ è€ç…§ç‰‡ï¼Œæ˜¯æˆ‘å°æ—¶å€™åœ¨æ²³è¾¹ç©è€çš„æ ·å­ï¼Œé‚£æ—¶å€™æ°´è¿˜å¾ˆæ¸…';
            document.getElementById('imagePreview').innerHTML = '<img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjE1MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMjAwIiBoZWlnaHQ9IjE1MCIgZmlsbD0iIzg3Y2VlYiIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmaWxsPSIjMzMzIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkeT0iLjNlbSI+56ul5bm055qE5rKz6L65PC90ZXh0Pjwvc3ZnPg==" class="uploaded-image">';
            addMessage('ï¼ˆæ¼”ç¤ºæ¨¡å¼ï¼šå‡è®¾å·²é€‰æ‹©ç«¥å¹´ç…§ç‰‡ï¼‰', 'ai');
        }
        
        function runDemo3() {
            document.getElementById('messageInput').value = 'ä»Šå¤©è·¯è¿‡å…¬å›­ï¼Œçœ‹åˆ°è¿™äº›èŠ±å¼€å¾—å¾ˆå¥½ï¼Œä½†æ€»è§‰å¾—å°‘äº†ä»€ä¹ˆ';
            document.getElementById('imagePreview').innerHTML = '<img src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjE1MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMjAwIiBoZWlnaHQ9IjE1MCIgZmlsbD0iI2ZmYzBjYiIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmaWxsPSIjNjY2IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkeT0iLjNlbSI+5YWs5Zut6Iqx5py1PC90ZXh0Pjwvc3ZnPg==" class="uploaded-image">';
            addMessage('ï¼ˆæ¼”ç¤ºæ¨¡å¼ï¼šå‡è®¾å·²é€‰æ‹©å…¬å›­ç…§ç‰‡ï¼‰', 'ai');
        }
        
        // åˆå§‹åŒ–
        checkStatus();
        
        // èšç„¦è¾“å…¥æ¡†
        document.getElementById('messageInput').focus();
    </script>
</body>
</html>